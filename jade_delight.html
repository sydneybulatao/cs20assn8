<!DOCTYPE html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>
<title>Jade Delight</title>
<link rel="stylesheet" href="style.css">
</head>

<body>
<script>

function MenuItem(name, cost)
{
	this.name = name;
	this.cost=cost;
}

menuItems = new Array(
	new MenuItem("Chicken Chop Suey", 4.5),
	new MenuItem("Sweet and Sour Pork", 6.25),
	new MenuItem("Shrimp Lo Mein", 6.25),
	new MenuItem("Moo Shi Chicken", 7.5),
	new MenuItem("Fried Rice", 2.85)
);

function makeSelect(name, minRange, maxRange)
{
	var t= "";
	t = "<select name='" + name + "' size='1'>";
	for (j=minRange; j<=maxRange; j++)
	   t += "<option>" + j + "</option>";
	t+= "</select>"; 
	return t;
}

function td(content, className="")
{
	return "<td class = '" + className + "'>" + content + "</td>";
}
	
</script>

<h1>Jade Delight</h1>
<form>

<p class="userInfo"><label>First Name:</label> <input type="text"  name='fname' /></p>
<p class="userInfo"><label>Last Name*</label>:  <input type="text"  name='lname' /></p>
<p class="userInfo address"><label>Street*</label>: <input type="text" name='street' /></p>
<p class="userInfo address"><label>City*</label>: <input type="text" name='city' /></p>
<p class="userInfo"><label>Phone*</label>: <input type="text"  name='phone' /></p>
<p> 
	<input type="radio"  name="p_or_d" value = "pickup" checked="checked"/>Pickup  
	<input type="radio"  name='p_or_d' value = 'delivery'/>
	Delivery
</p>
<table border="0" cellpadding="3">
  <tr>
    <th>Select Item</th>
    <th>Item Name</th>
    <th>Cost Each</th>
    <th>Total Cost</th>
  </tr>
<script>

  var s = "";
  for (i=0; i< menuItems.length; i++)
  {
	  s += "<tr>";
	  s += td(makeSelect("quan" + i, 0, 10),"selectQuantity");
	  s += td(menuItems[i].name, "itemName");
	  s += td("$" +menuItems[i].cost.toFixed(2), "cost");
	  s += td("$<input type='text' name='cost'/>", "totalCost");
	  s+= "</tr>";
  }
  document.writeln(s);
  
  // **** my added code **** 
  
  $(document).ready
(
  function()
  {
  // initialize values
  $('.userInfo.address').css("display","none");
  initializeCosts();
  // end initialize values
  
  // calculate total costs for all rows
  updateCost($("table").find("tr:eq(1)"));
  updateCost($("table").find("tr:eq(2)"));
  updateCost($("table").find("tr:eq(3)"));
  updateCost($("table").find("tr:eq(4)"));
  updateCost($("table").find("tr:eq(5)"));
  // end calculate total costs
  
  // street and city fields display
  $('.userInfo.address').css("display","none");
  deliveryMethod = "pickup";
  $('input:radio[value="pickup"]').click(function() 
  {
	  $('.userInfo.address').css("display","none");
	  deliveryMethod = "pickup";
  });
  $('input:radio[value="delivery"]').click(function() 
  {
	  $('.userInfo.address').css("display","block");
	  deliveryMethod = "delivery";
  });
  // end street and city fields display
  
  // form validation	
  $('input:button[value="Submit Order"]').click(function()
  {
	  valid = true;
	  verifyLast();
	  verifyPhone();
	  getTime();
	  if (deliveryMethod == "delivery") {verifyAddress();}
	  verifyItemOrdered();
	  if (valid) {displayOrder()};
  });
  // end form validation
  }
);

  function initializeCosts()
  {
	  zeroCost($("table").find("tr:eq(1)"));
	  zeroCost($("table").find("tr:eq(2)"));
	  zeroCost($("table").find("tr:eq(3)"));
	  zeroCost($("table").find("tr:eq(4)"));
	  zeroCost($("table").find("tr:eq(5)"));
	  zeroTotal($('input:text[name="subtotal"]'));
	  zeroTotal($('input:text[name="tax"]'));
	  zeroTotal($('input:text[name="total"]'));
  }
  
  function zeroTotal(total)
  {
	total.val(0);
  }
  
  function zeroCost(row)
  {
	  totalCost = row.find("td:eq(3)>input");
	  totalCost.val(0);
  }

  function updateCost(currRow)
  {
	  selection = currRow.find("td:eq(0)>select");
	  
	  selection.change(function()
	{
	  qty = currRow.find("td:eq(0)>select").val();
	  cost = currRow.find("td:eq(2)").text();
	  totalCost = currRow.find("td:eq(3)>input");
	  oldTotalCost = parseFloat(totalCost.val());
	  
	  totalCostValue = newCost(cost, qty);
	  totalCost.val(totalCostValue);
	  
	  updateSubtotal(totalCost.val() - oldTotalCost);
	  updateTax();
	  updateTotal();
	});
  }

  function updateSubtotal(change)
  {
	  oldSubtotal = parseFloat($('input:text[name="subtotal"]').val());
	  newSubtotal = (oldSubtotal + change).toFixed(2);
	  $('input:text[name="subtotal"]').val(newSubtotal);
  }
  
  function updateTax()
  {
	  newTax = (newSubtotal * 0.0625).toFixed(2);
	  $('input:text[name="tax"]').val(newTax);
  }
  
  function updateTotal()
  {
	 newSubtotal = parseFloat(newSubtotal);
	 newTax = parseFloat(newTax);
	 newTotal = (newSubtotal + newTax).toFixed(2);
	 $('input:text[name="total"]').val(newTotal);
  }

  function newCost(cost, qty)
  {
	cost = cost.substring(1);
  	cost = parseFloat(cost);
  	return (cost * qty).toFixed(2);
  }

  function verifyLast()
  {
	  lastName = $('input:text[name="lname"]').val();
	  if(lastName == "")
	  {
		  alert("Enter last name.");
		  valid = false;
	  }
  }
  
  function verifyPhone()
  {
	  phoneText = $('input:text[name="phone"]').val();
	  phoneNum = phoneText.replace(/\D/g,"");
	  if(phoneNum.length != 7 && phoneNum.length != 10)
	  {
		  alert("Enter valid phone number.");
		  valid = false;
	  }
  }
  
  function getTime()
  {
	  today = new Date();
	  if(deliveryMethod == "pickup")
	  {
		  actualTime =  calculateTime(15);
	  }
	  else 
	  {
		  actualTime =  calculateTime(30);
	  }
  }
  
  function calculateTime(prepTime)
  {
	  hour = today.getHours();
	  min = today.getMinutes();
	  min += prepTime;
	  if (min >= 60)
	  {
		  min = min-60;
		  hour++;
	  }
	  if (min < 10)
	  {
		  min = "0" + min;
	  }
	  if (hour > 12)
	  {
		  hour = hour-12;
	  }
	  time = hour + ":" + min;
	  return time;
  }
  
  function verifyAddress()
  {
	  street = $('input:text[name="street"]').val();
	  city = $('input:text[name="city"]').val();
	  if (street == "")
	  {
		  alert("Enter street.");
		  valid = false;
	  }
	  if (city == "")
	  {
		  alert("Enter city.");
		  valid = false;
	  }
  }
  
  function verifyItemOrdered()
  {
	  currSubtotal = $('input:text[name="subtotal"]').val();
	  currSubtotal = parseFloat(currSubtotal);
	  if (currSubtotal == 0)
	  {
		  alert("Please order at least one item.")
		  valid = false;
	  }
  }
  
  function getOrderSummary()
  {
	  orderSummary = "<h2>Thank you for your order!</h2>";
	  
	  orderSummary += "Time Ready: " + actualTime + "<br><br>";
	  
	  orderSummary += itemInfo($("table").find("tr:eq(1)"));
	  orderSummary += itemInfo($("table").find("tr:eq(2)"));
	  orderSummary += itemInfo($("table").find("tr:eq(3)"));
	  orderSummary += itemInfo($("table").find("tr:eq(4)"));
	  orderSummary += itemInfo($("table").find("tr:eq(5)"));
	  
	  orderSummary += "<br>";
	  orderSummary += "Subtotal: $" + $('input:text[name="subtotal"]').val() + "<br>";
	  orderSummary += "Tax: $" + $('input:text[name="tax"]').val() + "<br>";
	  orderSummary += "Total: $" + $('input:text[name="total"]').val() + "<br>";
	  
	  return orderSummary;
  }
  
  function itemInfo(row)
  {
	  qty = row.find("td:eq(0)>select").val();
	  if (qty == "0" || qty == "0.00")
	  {
		  return "";
	  }
	  totalCost = row.find("td:eq(3)>input").val();
	  name = row.find("td:eq(1)").text();
	  return (name + " (" + qty + "): $" + totalCost + "<br>");
  }
  
  function displayOrder()
  {
	  alert("Thank you for your order!");
	  localStorage.setItem("orderInfo", getOrderSummary());
	  window.open("order.html");
  }
  
  // **** end my code ****
  
</script>
</table>
<p class="subtotal totalSection"><label>Subtotal:</label> 
   $ <input type="text"  name='subtotal' id="subtotal" />
</p>
<p class="tax totalSection"><label>Mass tax 6.25%:</label>
  $ <input type="text"  name='tax' id="tax" />
</p>
<p class="total totalSection"><label>Total:</label> $ <input type="text"  name='total' id="total" />
</p>

<input type = "button" value = "Submit Order" />

</form>
</body>
</html>